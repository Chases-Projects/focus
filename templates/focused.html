<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Daily Focus Sheet</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .task-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin-bottom: 5px;
        }
        .task-row form {
            margin: 0;
        }
        .completed {
            text-decoration: line-through;
            color: gray;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>üóìÔ∏è Daily Focus Sheet</h1>

    {% for category, tasks in [('Top 3 Priorities', top3), ('To-Do Queue', todo), ('Distraction Log', distractions)] %}
        <h2>{{ category }}</h2>
        <button onclick="toggleCompleted(this)">Show Completed</button>
        <ul>
            {% for item in tasks %}
                {% set is_editing = request.args.get('edit_id', type=int) == item.id %}
                <li class="task-row {% if item.completed %}completed-item hidden{% endif %}">
                    <form method="POST" style="margin-right: 10px;">
                        <input type="hidden" name="section" value="complete">
                        <input type="hidden" name="task_id" value="{{ item.id }}">
                        <input type="checkbox" onChange="this.form.submit()" {% if item.completed %}checked{% endif %}>
                    </form>

                    {% if is_editing %}
                        <form method="POST" style="flex-grow: 1; display: flex;">
                            <input name="item" value="{{ item.content }}" style="flex-grow: 1;">
                            <input type="hidden" name="section" value="edit">
                            <input type="hidden" name="task_id" value="{{ item.id }}">
                            <button type="submit">üíæ</button>
                        </form>
                    {% else %}
                        <span class="{% if item.completed %}completed{% endif %}" style="flex-grow: 1;">
                            {{ item.content }}
                        </span>
                        <form method="POST">
                            <input type="hidden" name="task_id" value="{{ item.id }}">
                            <input type="hidden" name="section" value="delete">
                            <button type="submit">üóëÔ∏è</button>
                        </form>
                        <form method="GET">
                            <input type="hidden" name="edit_id" value="{{ item.id }}">
                            <button type="submit">‚úèÔ∏è</button>
                        </form>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>

        <form method="POST">
            <input name="item" placeholder="Add new item">
            <input type="hidden" name="section" value="{{ 'top3' if 'Top 3' in category else 'todo' if 'To-Do' in category else 'distractions' }}">
            <button type="submit">Add</button>
        </form>
    {% endfor %}

    <h2>üß† Quick Notes</h2>
    <form method="POST">
        <textarea name="item" rows="5">{{ note.content if note else '' }}</textarea>
        <input type="hidden" name="section" value="notes">
        <button type="submit">Save</button>
    </form>

    <script>
        function toggleCompleted(button) {
            const hiddenTasks = document.querySelectorAll('.completed-item');
            hiddenTasks.forEach(task => task.classList.toggle('hidden'));
            button.textContent = button.textContent.includes('Show') ? 'Hide Completed' : 'Show Completed';
        }
    </script>
</body>
</html>
